% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/downsample.R
\name{downsample}
\alias{downsample}
\title{============================================================================EEG Downsampling Functions}
\usage{
downsample(
  eeg_obj,
  target_rate,
  method = c("decimate", "simple"),
  filter_order = 8,
  cutoff_ratio = 0.9,
  preserve_bands = NULL,
  event_strategy = c("round", "nearest", "floor", "ceiling"),
  remove_outbound_events = TRUE,
  verbose = TRUE
)
}
\arguments{
\item{eeg_obj}{An object of class 'eeg' containing EEG data}

\item{target_rate}{Numeric value specifying the desired sampling rate in Hz.
Must be lower than current sampling rate and satisfy
Nyquist theorem (at least 2 times highest frequency of interest).
Common values: 128, 256, 512 Hz}

\item{method}{Character string specifying downsampling method:
\describe{
\item{"decimate"}{(default) Applies anti-aliasing filter then decimates.
Recommended for all research applications.}
\item{"simple"}{Direct downsampling without filtering.
Not recommended - may cause spectral aliasing.}
}}

\item{filter_order}{Integer specifying the order of the anti-aliasing Butterworth filter.
Default: 8. Higher values create sharper cutoff (more computation).
Typical range: 4-12.}

\item{cutoff_ratio}{Numeric value between 0 and 1 specifying the filter cutoff
as a proportion of the new Nyquist frequency.
Default: 0.9 (90\% of Nyquist).
Formula: cutoff_freq = (target_rate / 2) times cutoff_ratio
Lower values (0.8) = more conservative, higher values (0.95) = more aggressive.}

\item{preserve_bands}{Numeric vector of length 2: c(min_freq, max_freq) in Hz.
If provided, validates that target sampling rate can preserve
these frequencies. Throws error if impossible.
Example: c(0.5, 50) for standard EEG bands.
Default: NULL (no validation).}

\item{event_strategy}{Character string specifying how event timing is adjusted:
\describe{
\item{"round"}{(default) Round to nearest sample}
\item{"nearest"}{Find temporally nearest sample}
\item{"floor"}{Always round down (event at or before actual time)}
\item{"ceiling"}{Always round up (event at or after actual time)}
}}

\item{remove_outbound_events}{Logical. If TRUE (default), removes events that fall
outside the downsampled time range with a warning.
If FALSE, clamps event indices to valid range.}

\item{verbose}{Logical indicating whether to print progress messages and summary.
Default: TRUE. Set to FALSE for batch processing.}
}
\value{
An 'eeg' object with downsampled data and updated parameters:
\describe{
\item{data}{Downsampled signal matrix (channels times new_timepoints)}
\item{sampling_rate}{Updated to actual achieved sampling rate}
\item{times}{Adjusted time vector for new sampling rate}
\item{events}{Event data frame with recalculated onset times}
\item{channels}{Unchanged channel names}
\item{metadata}{Unchanged metadata}
\item{reference}{Unchanged reference scheme}
\item{preprocessing_history}{Updated with downsampling record}
}
}
\description{
This module provides functions for downsampling EEG data to reduce sampling
rate while preserving signal integrity. Downsampling is essential for
reducing computational overhead, file sizes, and analysis time without
losing meaningful neural information.
}
\details{
The module implements anti-aliasing filters to prevent spectral aliasing
artifacts when reducing sampling rate. Most EEG analyses work well with
250-512 Hz sampling, even when data is recorded at higher rates like
2048 Hz.
}
\section{Author: Christos Dalamarinis
Date: 2026}{
Downsample EEG Data

Reduces the sampling rate of EEG data by applying an anti-aliasing low-pass
filter followed by decimation. This function preserves signal integrity while
reducing computational overhead and file size.

The function performs the following steps:
\enumerate{
\item Validates input parameters and data quality
\item Calculates downsampling factor (must result in integer ratio)
\item Applies anti-aliasing low-pass Butterworth filter at cutoff frequency
\item Decimates the signal by selecting every nth sample
\item Updates time vector and event onset times accordingly
\item Validates and adjusts events for new sampling rate
}

\strong{Anti-aliasing filtering} prevents spectral aliasing by removing frequencies
above the new Nyquist frequency before decimation. The Butterworth filter is
applied with zero-phase filtering (forward-backward) using filtfilt().

\strong{Frequency Preservation:}
The cutoff frequency determines what frequencies are preserved:
\itemize{
\item{Target 512 Hz -> cutoff ~230 Hz -> suitable for high gamma}
\item{Target 256 Hz -> cutoff ~115 Hz -> suitable for RIFT/SSVEP studies}
\item{Target 128 Hz -> cutoff ~58 Hz -> suitable only for standard EEG bands}
}

\strong{DO NOT downsample if you need to preserve:}
\itemize{
\item{RIFT/SSVEP signals (60-120 Hz) -> keep at least 256 Hz sampling}
\item{High gamma (60-100 Hz) -> keep at least 200 Hz sampling}
\item{Ripples (80-250 Hz) -> keep  at least 500 Hz sampling}
}
}

\examples{
\dontrun{
  # Standard ERP analysis (preserve 0.5-50 Hz)
  eeg_down <- downsample_eeg(eeg, target_rate = 256,
                             preserve_bands = c(0.5, 50))

  # RIFT study (preserve 60-100 Hz)
  eeg_down <- downsample_eeg(eeg, target_rate = 512,
                             preserve_bands = c(60, 100),
                             filter_order = 10)
  
  # Conservative downsampling
  eeg_down <- downsample_eeg(eeg, target_rate = 256,
                             cutoff_ratio = 0.8,
                             event_strategy = "floor")
  
  # Batch processing (silent)
  eeg_down <- downsample_eeg(eeg, target_rate = 256, verbose = FALSE)
}

}
\seealso{
\code{\link{new_eeg}} for EEG object structure
}
